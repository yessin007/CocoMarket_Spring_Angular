import { Component, Input, Output, EventEmitter, ContentChild, ChangeDetectionStrategy, forwardRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { ActiveRating, FractionRating, InactiveRating } from './custom-rating';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./bar-rating.pipe";
/** This allows support [(ngModel)] and ngControl. */
const RATING_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => BarRating),
    multi: true
};
/** This allows control required validation. */
const RATING_VALUE_VALIDATOR = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(() => BarRating),
    multi: true,
};
var BarRatingUnitState;
(function (BarRatingUnitState) {
    BarRatingUnitState["active"] = "active";
    BarRatingUnitState["inactive"] = "inactive";
    BarRatingUnitState["selected"] = "selected";
    BarRatingUnitState["fraction"] = "fraction";
})(BarRatingUnitState || (BarRatingUnitState = {}));
export class BarRating {
    constructor(changeDetectorRef) {
        this.changeDetectorRef = changeDetectorRef;
        this.unitState = BarRatingUnitState;
        this.contexts = [];
        /** Maximal rating that can be given using this widget. */
        this.max = 5;
        /** A flag indicating if rating can be updated. */
        this.readOnly = false;
        /** Set the theme */
        this.theme = 'default';
        /** Show rating title */
        this.showText = false;
        /** Replace rate value with a title */
        this.titles = [];
        /** A flag indicating if rating is required for form validation. */
        this.required = false;
        /**
         * A stream that emits when a user is hovering over a given rating.
         * Event's payload equals to the rating being hovered over.
         */
        this.hover = new EventEmitter();
        /**
         * A stream that emits when a user stops hovering over a given rating.
         * Event's payload equals to the rating of the last item being hovered over.
         */
        this.leave = new EventEmitter();
        /**
         * A stream that emits when a user selects a new rating.
         * Event's payload equals to the newly selected rating.
         */
        this.rateChange = new EventEmitter(true);
        /**
         * A stream that forwards a bar rating click since clicks are not propagated
         */
        this.barClick = new EventEmitter();
    }
    ngOnChanges(changes) {
        if (changes.rate) {
            this.update(this.rate);
        }
    }
    ngOnInit() {
        this.contexts = Array.from({ length: this.max }, (context, i) => ({
            state: BarRatingUnitState.inactive,
            click: () => this.handleClick(i + 1),
            enter: () => this.handleEnter(i + 1)
        }));
        this.updateState(this.rate);
    }
    update(newRate, internalChange = true) {
        if (!this.readOnly && !this.disabled && this.rate !== newRate) {
            this.rate = newRate;
            this.rateChange.emit(this.rate);
        }
        if (internalChange) {
            this.onChange(this.rate);
            this.onTouched();
        }
        this.updateState(this.rate);
    }
    /** Reset rate value */
    reset() {
        this.leave.emit(this.nextRate);
        this.updateState(this.rate);
    }
    updateState(nextValue) {
        /** Set rate value as text */
        this.nextRate = nextValue - 1;
        /** Set the rating */
        this.contexts = Array.from({ length: this.max }, (context, index) => ({
            state: index + 1 <= nextValue
                ? BarRatingUnitState.selected
                : (index + 1 === Math.round(nextValue) && nextValue % 1) >= 0.5
                    ? BarRatingUnitState.fraction
                    : BarRatingUnitState.inactive,
            click: () => this.handleClick(index),
            enter: () => this.handleEnter(index)
        }));
    }
    handleClick(value) {
        this.update(value + 1);
    }
    handleEnter(index) {
        if (!this.disabled && !this.readOnly) {
            /** Add selected class for rating hover */
            this.contexts.map((context, i) => {
                context.state = i <= index ? BarRatingUnitState.active : BarRatingUnitState.inactive;
            });
            this.nextRate = index;
            this.hover.emit(index);
        }
    }
    /** This is the initial value set to the component */
    writeValue(value) {
        this.update(value, false);
        this.changeDetectorRef.markForCheck();
    }
    validate(c) {
        return (this.required && !c.value) ? { required: true } : null;
    }
    onChange(_) {
    }
    onTouched() {
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
}
BarRating.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: BarRating, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
BarRating.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: BarRating, selector: "bar-rating", inputs: { rate: "rate", max: "max", readOnly: "readOnly", theme: "theme", showText: "showText", titles: "titles", required: "required" }, outputs: { hover: "hover", leave: "leave", rateChange: "rateChange", barClick: "barClick" }, providers: [RATING_VALUE_ACCESSOR, RATING_VALUE_VALIDATOR], queries: [{ propertyName: "customActiveRating", first: true, predicate: ActiveRating, descendants: true }, { propertyName: "customInActiveRating", first: true, predicate: InactiveRating, descendants: true }, { propertyName: "customFractionRating", first: true, predicate: FractionRating, descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div class=\"br br-{{ customInActiveRating ? '' : theme }}\"\r\n     [class.br-readonly]=\"readOnly\"\r\n     [class.br-disabled]=\"disabled\">\r\n\r\n  <div class=\"br-units\" (mouseleave)=\"reset()\">\r\n\r\n    <div *ngFor=\"let unit of contexts\"\r\n         class=\"br-unit\"\r\n         (click)=\"unit.click($event)\"\r\n         (mouseenter)=\"unit.enter()\">\r\n\r\n      <ng-container [ngSwitch]=\"unit.state\">\r\n        <ng-template *ngSwitchCase=\"unitState.fraction\" [ngTemplateOutlet]=\"customFractionRating?.template || fractionTemplate\"></ng-template>\r\n        <ng-template *ngSwitchCase=\"unitState.inactive\" [ngTemplateOutlet]=\"customInActiveRating?.template || inactiveTemplate\"></ng-template>\r\n        <ng-template *ngSwitchDefault [ngTemplateOutlet]=\"customActiveRating?.template || activeTemplate\"></ng-template>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n\r\n  <div *ngIf=\"showText\" class=\"br-text\">{{ nextRate + 1 | rateTitle: titles }}</div>\r\n</div>\r\n\r\n<ng-template #fractionTemplate>\r\n  <div class=\"br-unit-inner br-fraction\"></div>\r\n</ng-template>\r\n\r\n<ng-template #activeTemplate>\r\n  <div class=\"br-unit-inner br-active\"></div>\r\n</ng-template>\r\n\r\n<ng-template #inactiveTemplate>\r\n  <div class=\"br-unit-inner br-inactive\"></div>\r\n</ng-template>\r\n", styles: ["*{box-sizing:border-box}:host{--br-font-size: 16px;--br-gap: 0;--br-active-color: #EDB867;--br-inactive-color: #D2D2D2}.br{position:relative}.br-units{display:flex;flex-wrap:nowrap;gap:var(--br-gap)}.br-unit{font-size:var(--br-font-size);cursor:pointer;-webkit-font-smoothing:antialiased;text-rendering:auto}.br-unit-inner{position:relative}.br-readonly .br-unit,.br-disabled .br-unit{cursor:default}\n"], directives: [{ type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { type: i1.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i1.NgSwitchDefault, selector: "[ngSwitchDefault]" }, { type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "rateTitle": i2.BarRatingPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: BarRating, decorators: [{
            type: Component,
            args: [{ selector: 'bar-rating', providers: [RATING_VALUE_ACCESSOR, RATING_VALUE_VALIDATOR], changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"br br-{{ customInActiveRating ? '' : theme }}\"\r\n     [class.br-readonly]=\"readOnly\"\r\n     [class.br-disabled]=\"disabled\">\r\n\r\n  <div class=\"br-units\" (mouseleave)=\"reset()\">\r\n\r\n    <div *ngFor=\"let unit of contexts\"\r\n         class=\"br-unit\"\r\n         (click)=\"unit.click($event)\"\r\n         (mouseenter)=\"unit.enter()\">\r\n\r\n      <ng-container [ngSwitch]=\"unit.state\">\r\n        <ng-template *ngSwitchCase=\"unitState.fraction\" [ngTemplateOutlet]=\"customFractionRating?.template || fractionTemplate\"></ng-template>\r\n        <ng-template *ngSwitchCase=\"unitState.inactive\" [ngTemplateOutlet]=\"customInActiveRating?.template || inactiveTemplate\"></ng-template>\r\n        <ng-template *ngSwitchDefault [ngTemplateOutlet]=\"customActiveRating?.template || activeTemplate\"></ng-template>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n\r\n  <div *ngIf=\"showText\" class=\"br-text\">{{ nextRate + 1 | rateTitle: titles }}</div>\r\n</div>\r\n\r\n<ng-template #fractionTemplate>\r\n  <div class=\"br-unit-inner br-fraction\"></div>\r\n</ng-template>\r\n\r\n<ng-template #activeTemplate>\r\n  <div class=\"br-unit-inner br-active\"></div>\r\n</ng-template>\r\n\r\n<ng-template #inactiveTemplate>\r\n  <div class=\"br-unit-inner br-inactive\"></div>\r\n</ng-template>\r\n", styles: ["*{box-sizing:border-box}:host{--br-font-size: 16px;--br-gap: 0;--br-active-color: #EDB867;--br-inactive-color: #D2D2D2}.br{position:relative}.br-units{display:flex;flex-wrap:nowrap;gap:var(--br-gap)}.br-unit{font-size:var(--br-font-size);cursor:pointer;-webkit-font-smoothing:antialiased;text-rendering:auto}.br-unit-inner{position:relative}.br-readonly .br-unit,.br-disabled .br-unit{cursor:default}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }]; }, propDecorators: { rate: [{
                type: Input
            }], max: [{
                type: Input
            }], readOnly: [{
                type: Input
            }], theme: [{
                type: Input
            }], showText: [{
                type: Input
            }], titles: [{
                type: Input
            }], required: [{
                type: Input
            }], hover: [{
                type: Output
            }], leave: [{
                type: Output
            }], rateChange: [{
                type: Output
            }], barClick: [{
                type: Output
            }], customActiveRating: [{
                type: ContentChild,
                args: [ActiveRating]
            }], customInActiveRating: [{
                type: ContentChild,
                args: [InactiveRating]
            }], customFractionRating: [{
                type: ContentChild,
                args: [FractionRating]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFyLXJhdGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1iYXItcmF0aW5nL3NyYy9saWIvYmFyLXJhdGluZy50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1iYXItcmF0aW5nL3NyYy9saWIvYmFyLXJhdGluZy5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBSVosWUFBWSxFQUVaLHVCQUF1QixFQUN2QixVQUFVLEVBQ1gsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFtQyxhQUFhLEVBQUUsaUJBQWlCLEVBQWUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoSCxPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7OztBQUUvRSxxREFBcUQ7QUFDckQsTUFBTSxxQkFBcUIsR0FBRztJQUM1QixPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDO0lBQ3hDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQUVGLCtDQUErQztBQUMvQyxNQUFNLHNCQUFzQixHQUFHO0lBQzdCLE9BQU8sRUFBRSxhQUFhO0lBQ3RCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDO0lBQ3hDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQUVGLElBQUssa0JBS0o7QUFMRCxXQUFLLGtCQUFrQjtJQUNyQix1Q0FBaUIsQ0FBQTtJQUNqQiwyQ0FBcUIsQ0FBQTtJQUNyQiwyQ0FBcUIsQ0FBQTtJQUNyQiwyQ0FBcUIsQ0FBQTtBQUN2QixDQUFDLEVBTEksa0JBQWtCLEtBQWxCLGtCQUFrQixRQUt0QjtBQWVELE1BQU0sT0FBTyxTQUFTO0lBdURwQixZQUFvQixpQkFBb0M7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QUs7Z0JBTUksS0FBSztzQkFBZCxNQUFNO2dCQU1HLEtBQUs7c0JBQWQsTUFBTTtnQkFNRyxVQUFVO3NCQUFuQixNQUFNO2dCQUtHLFFBQVE7c0JBQWpCLE1BQU07Z0JBRXFCLGtCQUFrQjtzQkFBN0MsWUFBWTt1QkFBQyxZQUFZO2dCQUNJLG9CQUFvQjtzQkFBakQsWUFBWTt1QkFBQyxjQUFjO2dCQUNFLG9CQUFvQjtzQkFBakQsWUFBWTt1QkFBQyxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBPbkluaXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgQ29udGVudENoaWxkLFxyXG4gIENoYW5nZURldGVjdG9yUmVmLFxyXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gIGZvcndhcmRSZWZcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciwgTkdfVkFMSURBVE9SUywgTkdfVkFMVUVfQUNDRVNTT1IsIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBBY3RpdmVSYXRpbmcsIEZyYWN0aW9uUmF0aW5nLCBJbmFjdGl2ZVJhdGluZyB9IGZyb20gJy4vY3VzdG9tLXJhdGluZyc7XHJcblxyXG4vKiogVGhpcyBhbGxvd3Mgc3VwcG9ydCBbKG5nTW9kZWwpXSBhbmQgbmdDb250cm9sLiAqL1xyXG5jb25zdCBSQVRJTkdfVkFMVUVfQUNDRVNTT1IgPSB7XHJcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQmFyUmF0aW5nKSxcclxuICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuLyoqIFRoaXMgYWxsb3dzIGNvbnRyb2wgcmVxdWlyZWQgdmFsaWRhdGlvbi4gKi9cclxuY29uc3QgUkFUSU5HX1ZBTFVFX1ZBTElEQVRPUiA9IHtcclxuICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEJhclJhdGluZyksXHJcbiAgbXVsdGk6IHRydWUsXHJcbn07XHJcblxyXG5lbnVtIEJhclJhdGluZ1VuaXRTdGF0ZSB7XHJcbiAgYWN0aXZlID0gJ2FjdGl2ZScsXHJcbiAgaW5hY3RpdmUgPSAnaW5hY3RpdmUnLFxyXG4gIHNlbGVjdGVkID0gJ3NlbGVjdGVkJyxcclxuICBmcmFjdGlvbiA9ICdmcmFjdGlvbidcclxufVxyXG5cclxuaW50ZXJmYWNlIEJhclJhdGluZ0NvbnRleHQge1xyXG4gIHN0YXRlOiBCYXJSYXRpbmdVbml0U3RhdGU7XHJcbiAgY2xpY2s6IChlKSA9PiB2b2lkO1xyXG4gIGVudGVyOiAoKSA9PiB2b2lkO1xyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2Jhci1yYXRpbmcnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9iYXItcmF0aW5nLmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2Jhci1yYXRpbmcuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1JBVElOR19WQUxVRV9BQ0NFU1NPUiwgUkFUSU5HX1ZBTFVFX1ZBTElEQVRPUl0sXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIEJhclJhdGluZyBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIHtcclxuXHJcbiAgcmVhZG9ubHkgdW5pdFN0YXRlID0gQmFyUmF0aW5nVW5pdFN0YXRlO1xyXG4gIGNvbnRleHRzOiBCYXJSYXRpbmdDb250ZXh0W10gPSBbXTtcclxuICBuZXh0UmF0ZTogbnVtYmVyO1xyXG4gIGRpc2FibGVkOiBib29sZWFuO1xyXG5cclxuICAvKiogQ3VycmVudCByYXRpbmcuIENhbiBiZSBhIGRlY2ltYWwgdmFsdWUgbGlrZSAzLjE0ICovXHJcbiAgQElucHV0KCkgcmF0ZTtcclxuXHJcbiAgLyoqIE1heGltYWwgcmF0aW5nIHRoYXQgY2FuIGJlIGdpdmVuIHVzaW5nIHRoaXMgd2lkZ2V0LiAqL1xyXG4gIEBJbnB1dCgpIG1heCA9IDU7XHJcblxyXG4gIC8qKiBBIGZsYWcgaW5kaWNhdGluZyBpZiByYXRpbmcgY2FuIGJlIHVwZGF0ZWQuICovXHJcbiAgQElucHV0KCkgcmVhZE9ubHkgPSBmYWxzZTtcclxuXHJcbiAgLyoqIFNldCB0aGUgdGhlbWUgKi9cclxuICBASW5wdXQoKSB0aGVtZSA9ICdkZWZhdWx0JztcclxuXHJcbiAgLyoqIFNob3cgcmF0aW5nIHRpdGxlICovXHJcbiAgQElucHV0KCkgc2hvd1RleHQgPSBmYWxzZTtcclxuXHJcbiAgLyoqIFJlcGxhY2UgcmF0ZSB2YWx1ZSB3aXRoIGEgdGl0bGUgKi9cclxuICBASW5wdXQoKSB0aXRsZXMgPSBbXTtcclxuXHJcbiAgLyoqIEEgZmxhZyBpbmRpY2F0aW5nIGlmIHJhdGluZyBpcyByZXF1aXJlZCBmb3IgZm9ybSB2YWxpZGF0aW9uLiAqL1xyXG4gIEBJbnB1dCgpIHJlcXVpcmVkID0gZmFsc2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIEEgc3RyZWFtIHRoYXQgZW1pdHMgd2hlbiBhIHVzZXIgaXMgaG92ZXJpbmcgb3ZlciBhIGdpdmVuIHJhdGluZy5cclxuICAgKiBFdmVudCdzIHBheWxvYWQgZXF1YWxzIHRvIHRoZSByYXRpbmcgYmVpbmcgaG92ZXJlZCBvdmVyLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBob3ZlciA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xyXG5cclxuICAvKipcclxuICAgKiBBIHN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gYSB1c2VyIHN0b3BzIGhvdmVyaW5nIG92ZXIgYSBnaXZlbiByYXRpbmcuXHJcbiAgICogRXZlbnQncyBwYXlsb2FkIGVxdWFscyB0byB0aGUgcmF0aW5nIG9mIHRoZSBsYXN0IGl0ZW0gYmVpbmcgaG92ZXJlZCBvdmVyLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBsZWF2ZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xyXG5cclxuICAvKipcclxuICAgKiBBIHN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gYSB1c2VyIHNlbGVjdHMgYSBuZXcgcmF0aW5nLlxyXG4gICAqIEV2ZW50J3MgcGF5bG9hZCBlcXVhbHMgdG8gdGhlIG5ld2x5IHNlbGVjdGVkIHJhdGluZy5cclxuICAgKi9cclxuICBAT3V0cHV0KCkgcmF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPih0cnVlKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQSBzdHJlYW0gdGhhdCBmb3J3YXJkcyBhIGJhciByYXRpbmcgY2xpY2sgc2luY2UgY2xpY2tzIGFyZSBub3QgcHJvcGFnYXRlZFxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBiYXJDbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xyXG5cclxuICBAQ29udGVudENoaWxkKEFjdGl2ZVJhdGluZykgY3VzdG9tQWN0aXZlUmF0aW5nOiBBY3RpdmVSYXRpbmc7XHJcbiAgQENvbnRlbnRDaGlsZChJbmFjdGl2ZVJhdGluZykgY3VzdG9tSW5BY3RpdmVSYXRpbmc6IEluYWN0aXZlUmF0aW5nO1xyXG4gIEBDb250ZW50Q2hpbGQoRnJhY3Rpb25SYXRpbmcpIGN1c3RvbUZyYWN0aW9uUmF0aW5nOiBGcmFjdGlvblJhdGluZztcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLnJhdGUpIHtcclxuICAgICAgdGhpcy51cGRhdGUodGhpcy5yYXRlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb250ZXh0cyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IHRoaXMubWF4IH0sIChjb250ZXh0OiBCYXJSYXRpbmdDb250ZXh0W10sIGk6IG51bWJlcikgPT4gKHtcclxuICAgICAgc3RhdGU6IEJhclJhdGluZ1VuaXRTdGF0ZS5pbmFjdGl2ZSxcclxuICAgICAgY2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlQ2xpY2soaSArIDEpLFxyXG4gICAgICBlbnRlcjogKCkgPT4gdGhpcy5oYW5kbGVFbnRlcihpICsgMSlcclxuICAgIH0pKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZVN0YXRlKHRoaXMucmF0ZSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGUobmV3UmF0ZTogbnVtYmVyLCBpbnRlcm5hbENoYW5nZTogYm9vbGVhbiA9IHRydWUpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5yZWFkT25seSAmJiAhdGhpcy5kaXNhYmxlZCAmJiB0aGlzLnJhdGUgIT09IG5ld1JhdGUpIHtcclxuICAgICAgdGhpcy5yYXRlID0gbmV3UmF0ZTtcclxuICAgICAgdGhpcy5yYXRlQ2hhbmdlLmVtaXQodGhpcy5yYXRlKTtcclxuICAgIH1cclxuICAgIGlmIChpbnRlcm5hbENoYW5nZSkge1xyXG4gICAgICB0aGlzLm9uQ2hhbmdlKHRoaXMucmF0ZSk7XHJcbiAgICAgIHRoaXMub25Ub3VjaGVkKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZVN0YXRlKHRoaXMucmF0ZSk7XHJcbiAgfVxyXG5cclxuICAvKiogUmVzZXQgcmF0ZSB2YWx1ZSAqL1xyXG4gIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5sZWF2ZS5lbWl0KHRoaXMubmV4dFJhdGUpO1xyXG4gICAgdGhpcy51cGRhdGVTdGF0ZSh0aGlzLnJhdGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVTdGF0ZShuZXh0VmFsdWUpOiB2b2lkIHtcclxuICAgIC8qKiBTZXQgcmF0ZSB2YWx1ZSBhcyB0ZXh0ICovXHJcbiAgICB0aGlzLm5leHRSYXRlID0gbmV4dFZhbHVlIC0gMTtcclxuICAgIC8qKiBTZXQgdGhlIHJhdGluZyAqL1xyXG4gICAgdGhpcy5jb250ZXh0cyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IHRoaXMubWF4IH0sIChjb250ZXh0OiBCYXJSYXRpbmdDb250ZXh0W10sIGluZGV4OiBudW1iZXIpID0+ICh7XHJcbiAgICAgIHN0YXRlOiBpbmRleCArIDEgPD0gbmV4dFZhbHVlXHJcbiAgICAgICAgPyBCYXJSYXRpbmdVbml0U3RhdGUuc2VsZWN0ZWRcclxuICAgICAgICA6IChpbmRleCArIDEgPT09IE1hdGgucm91bmQobmV4dFZhbHVlKSAmJiBuZXh0VmFsdWUgJSAxKSA+PSAwLjVcclxuICAgICAgICAgID8gQmFyUmF0aW5nVW5pdFN0YXRlLmZyYWN0aW9uXHJcbiAgICAgICAgICA6IEJhclJhdGluZ1VuaXRTdGF0ZS5pbmFjdGl2ZSxcclxuICAgICAgY2xpY2s6ICgpID0+IHRoaXMuaGFuZGxlQ2xpY2soaW5kZXgpLFxyXG4gICAgICBlbnRlcjogKCkgPT4gdGhpcy5oYW5kbGVFbnRlcihpbmRleClcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlQ2xpY2sodmFsdWU6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy51cGRhdGUodmFsdWUgKyAxKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlRW50ZXIoaW5kZXgpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiAhdGhpcy5yZWFkT25seSkge1xyXG4gICAgICAvKiogQWRkIHNlbGVjdGVkIGNsYXNzIGZvciByYXRpbmcgaG92ZXIgKi9cclxuICAgICAgdGhpcy5jb250ZXh0cy5tYXAoKGNvbnRleHQ6IEJhclJhdGluZ0NvbnRleHQsIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgIGNvbnRleHQuc3RhdGUgPSBpIDw9IGluZGV4ID8gQmFyUmF0aW5nVW5pdFN0YXRlLmFjdGl2ZSA6IEJhclJhdGluZ1VuaXRTdGF0ZS5pbmFjdGl2ZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMubmV4dFJhdGUgPSBpbmRleDtcclxuICAgICAgdGhpcy5ob3Zlci5lbWl0KGluZGV4KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBUaGlzIGlzIHRoZSBpbml0aWFsIHZhbHVlIHNldCB0byB0aGUgY29tcG9uZW50ICovXHJcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLnVwZGF0ZSh2YWx1ZSwgZmFsc2UpO1xyXG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRlKGM6IEZvcm1Db250cm9sKTogeyByZXF1aXJlZDogYm9vbGVhbiB9IHwgbnVsbCB7XHJcbiAgICByZXR1cm4gKHRoaXMucmVxdWlyZWQgJiYgIWMudmFsdWUpID8geyByZXF1aXJlZDogdHJ1ZSB9IDogbnVsbDtcclxuICB9XHJcblxyXG4gIG9uQ2hhbmdlKF86IGFueSk6IHZvaWQge1xyXG4gIH1cclxuXHJcbiAgb25Ub3VjaGVkKCk6IHZvaWQge1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKHZhbHVlOiBhbnkpID0+IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcclxuICB9XHJcblxyXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XHJcbiAgfVxyXG5cclxufVxyXG4iLCI8ZGl2IGNsYXNzPVwiYnIgYnIte3sgY3VzdG9tSW5BY3RpdmVSYXRpbmcgPyAnJyA6IHRoZW1lIH19XCJcclxuICAgICBbY2xhc3MuYnItcmVhZG9ubHldPVwicmVhZE9ubHlcIlxyXG4gICAgIFtjbGFzcy5ici1kaXNhYmxlZF09XCJkaXNhYmxlZFwiPlxyXG5cclxuICA8ZGl2IGNsYXNzPVwiYnItdW5pdHNcIiAobW91c2VsZWF2ZSk9XCJyZXNldCgpXCI+XHJcblxyXG4gICAgPGRpdiAqbmdGb3I9XCJsZXQgdW5pdCBvZiBjb250ZXh0c1wiXHJcbiAgICAgICAgIGNsYXNzPVwiYnItdW5pdFwiXHJcbiAgICAgICAgIChjbGljayk9XCJ1bml0LmNsaWNrKCRldmVudClcIlxyXG4gICAgICAgICAobW91c2VlbnRlcik9XCJ1bml0LmVudGVyKClcIj5cclxuXHJcbiAgICAgIDxuZy1jb250YWluZXIgW25nU3dpdGNoXT1cInVuaXQuc3RhdGVcIj5cclxuICAgICAgICA8bmctdGVtcGxhdGUgKm5nU3dpdGNoQ2FzZT1cInVuaXRTdGF0ZS5mcmFjdGlvblwiIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImN1c3RvbUZyYWN0aW9uUmF0aW5nPy50ZW1wbGF0ZSB8fCBmcmFjdGlvblRlbXBsYXRlXCI+PC9uZy10ZW1wbGF0ZT5cclxuICAgICAgICA8bmctdGVtcGxhdGUgKm5nU3dpdGNoQ2FzZT1cInVuaXRTdGF0ZS5pbmFjdGl2ZVwiIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImN1c3RvbUluQWN0aXZlUmF0aW5nPy50ZW1wbGF0ZSB8fCBpbmFjdGl2ZVRlbXBsYXRlXCI+PC9uZy10ZW1wbGF0ZT5cclxuICAgICAgICA8bmctdGVtcGxhdGUgKm5nU3dpdGNoRGVmYXVsdCBbbmdUZW1wbGF0ZU91dGxldF09XCJjdXN0b21BY3RpdmVSYXRpbmc/LnRlbXBsYXRlIHx8IGFjdGl2ZVRlbXBsYXRlXCI+PC9uZy10ZW1wbGF0ZT5cclxuICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuXHJcbiAgPGRpdiAqbmdJZj1cInNob3dUZXh0XCIgY2xhc3M9XCJici10ZXh0XCI+e3sgbmV4dFJhdGUgKyAxIHwgcmF0ZVRpdGxlOiB0aXRsZXMgfX08L2Rpdj5cclxuPC9kaXY+XHJcblxyXG48bmctdGVtcGxhdGUgI2ZyYWN0aW9uVGVtcGxhdGU+XHJcbiAgPGRpdiBjbGFzcz1cImJyLXVuaXQtaW5uZXIgYnItZnJhY3Rpb25cIj48L2Rpdj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjYWN0aXZlVGVtcGxhdGU+XHJcbiAgPGRpdiBjbGFzcz1cImJyLXVuaXQtaW5uZXIgYnItYWN0aXZlXCI+PC9kaXY+XHJcbjwvbmctdGVtcGxhdGU+XHJcblxyXG48bmctdGVtcGxhdGUgI2luYWN0aXZlVGVtcGxhdGU+XHJcbiAgPGRpdiBjbGFzcz1cImJyLXVuaXQtaW5uZXIgYnItaW5hY3RpdmVcIj48L2Rpdj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuIl19